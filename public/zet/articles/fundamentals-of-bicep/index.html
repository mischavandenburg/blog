<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Notes: Fundamentals of Bicep | Mischa van den Burg</title>
<meta name=keywords content="Article,Study,Azure,Coding,Bicep"><meta name=description content="I&rsquo;ll be working with Bicep during my next contract, so I&rsquo;m working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.
Why Bicep?
Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability."><meta name=author content="Mischa van den Burg"><link rel=canonical href=https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://mischavandenburg.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mischavandenburg.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mischavandenburg.com/favicon-32x32.png><link rel=apple-touch-icon href=https://mischavandenburg.com/apple-touch-icon.png><link rel=mask-icon href=https://mischavandenburg.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLS3GJYW82"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLS3GJYW82")}</script><meta property="og:url" content="https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/"><meta property="og:site_name" content="Mischa van den Burg"><meta property="og:title" content="Notes: Fundamentals of Bicep"><meta property="og:description" content="I‚Äôll be working with Bicep during my next contract, so I‚Äôm working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.
Why Bicep? Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="zet"><meta property="article:published_time" content="2023-03-13T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-13T00:00:00+00:00"><meta property="article:tag" content="Article"><meta property="article:tag" content="Study"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Coding"><meta property="article:tag" content="Bicep"><meta property="og:image" content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta name=twitter:title content="Notes: Fundamentals of Bicep"><meta name=twitter:description content="I&rsquo;ll be working with Bicep during my next contract, so I&rsquo;m working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.
Why Bicep?
Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Zettelkasten","item":"https://mischavandenburg.com/zet/"},{"@type":"ListItem","position":2,"name":"All Articles","item":"https://mischavandenburg.com/zet/articles/"},{"@type":"ListItem","position":3,"name":"Notes: Fundamentals of Bicep","item":"https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Notes: Fundamentals of Bicep","name":"Notes: Fundamentals of Bicep","description":"I\u0026rsquo;ll be working with Bicep during my next contract, so I\u0026rsquo;m working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.\nWhy Bicep? Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability.\n","keywords":["Article","Study","Azure","Coding","Bicep"],"articleBody":"I‚Äôll be working with Bicep during my next contract, so I‚Äôm working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.\nWhy Bicep? Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability.\nBicep templates are transpiled into JSON objects, which are sent to the Azure API to create resources with the Azure Resource Manager.\nFundamentals of Bicep Notes A parameter lets you bring in values from outside the template file. For example, if someone is manually deploying the template by using the Azure CLI or Azure PowerShell, they‚Äôll be asked to provide values for each parameter. They can also create a parameter file, which lists all of the parameters and values they want to use for the deployment. If the template is deployed from an automated process like a deployment pipeline, the pipeline can provide the parameter values.\nA variable is defined and set within the template. Variables let you store important information in one place and refer to it throughout the template without having to copy and paste it.\ngenerating unique names Bicep has another function called uniqueString() that comes in handy when you‚Äôre creating resource names. When you use this function, you need to provide a seed value, which should be different across different deployments but consistent across all deployments of the same resources.\nparam storageAccountName string = uniqueString(resourceGroup().id) Every time you deploy the same resources, they‚Äôll go into the same resource group. The uniqueString() function will return the same value every time. If you deploy into two different resource groups in the Azure subscription, the resourceGroup().id value will be different, because the resource group names will be different. The uniqueString() function will give different values for each set of resources. If you deploy into two different Azure subscriptions, even if you use the same resource group name, the resourceGroup().id value will be different because the Azure subscription ID will be different. The uniqueString() function will again give different values for each set of resources. combining strings Can use string interpolation to generate a unique string with a recognizable hardcoded part:\nparam storageAccountName string = 'toylaunch${uniqueString(resourceGroup().id)}'\nThis can also be handy for generating correct names. For example, storage accounts may not begin with a number.\nparameter decorators allowed parameters @allowed([ 'nonprod' 'prod' ]) param environmentType string The template cannot be deployed unless the nonprod or prod values are provided.\n@allowed is a parameter decorator: it gives Bicep information on what the parameter‚Äôs value needs to be.\nYou can also specify the allowed length of the parameter by using the following decorators:\n@minLength(5) @maxLength(24) param storageAccountName string You can apply multiple decorators to a parameter by putting each on a separate line.\nThese min and maxLength decorators can also be used to limit the length of an array.\nTo limit int values:\n@minValue(1) @maxValue(10) param appServicePlanInstanceCount int Finally, you can add descriptions to your parameters with the @description decorator:\n@description('The locations into which this Cosmos DB account should be configured. This parameter needs to be a list of objects, each of which has a locationName property.') param cosmosDBAccountLocations array if statements var storageAccountSkuName = (environmentType == 'prod') ? 'Standard_GRS' : 'Standard_LRS' var appServicePlanSkuName = (environmentType == 'prod') ? 'P2V3' : 'F1' Let‚Äôs unpack this:\n? is a ternary operator and evaluates an if/then statement. The value after ? is used if the expression is true. If it‚Äôs false, the value after : is used.\nSo here, if the environmentType is prod, the SKU is set to Standard_GRS\nObjects in Bicep You can use objects within resource definitions, within variables, or within expressions in your Bicep file.\nObjects are the same as dictionaries in python:\nparam appServicePlanSku object = { name: 'F1' tier: 'Free' capacity: 1 } These are called ‚Äúproperties‚Äù of type string and int. Note that they are line separated, not comma separated like in python.\nWhen referencing the parameter in the template, you can use dot notation to access the object properties:\nresource appServicePlan 'Microsoft.Web/serverfarms@2022-03-01' = { name: appServicePlanName location: location sku: { name: appServicePlanSku.name tier: appServicePlanSku.tier capacity: appServicePlanSku.capacity } } [!important] Keep in mind that you don‚Äôt specify the type of each property within an object. However, when you use a property‚Äôs value, its type must match what‚Äôs expected. In the previous example, both the name and the tier of the App Service plan SKU must be strings.\nExample: tags param resourceTags object = { EnvironmentName: 'Test' CostCenter: '1000100' Team: 'Human Resources' } resource appServicePlan 'Microsoft.Web/serverfarms@2022-03-01' = { name: appServicePlanName location: location tags: resourceTags sku: { name: 'S1' } } resource appServiceApp 'Microsoft.Web/sites@' = { name: appServiceAppName location: location tags: resourceTags kind: 'app' properties: { serverFarmId: appServicePlan.id } } Here we take the tags for all the resources of the template as parameters. But we easily reuse all the tags for each resource by referencing the entire object.\nArrays Arrays are not typed in Bicep. You cannot specify that it must contain strings.\nExample:\nparam cosmosDBAccountLocations array = [ { locationName: 'australiaeast' } { locationName: 'southcentralus' } { locationName: 'westeurope' } ] This is an array of objects, which have an locationName property each.\nAnd you would access it by:\nresource account 'Microsoft.DocumentDB/databaseAccounts@2022-08-15' = { name: accountName location: location properties: { locations: cosmosDBAccountLocations } } Specifying parameter values When deploying a template file there are three options:\ndefault values command line parameter file Parameter file This is a json file. To deploy a template with a paramter file, use:\naz deployment group create \\ --template-file main.bicep \\ --parameters main.parameters.json priority The order of priority is this, from high to low priority:\nParameters specified on the command line Parameter file Default values in template Securing parameters It is best to use Managed Identities for Azure, but if you need to supply secret values to a deployment, use the @secure() decorator. These values aren‚Äôt available in the deployment logs, and they won‚Äôt be displayed on the screen when entered in the terminal.\nLoops Defined with the for keyword. Usually you iterate over an array to create multiple instances of a resource.\nCopy loops param storageAccountNames array = [ 'saauditus' 'saauditeurope' 'saauditapac' ] resource storageAccountResources 'Microsoft.Storage/storageAccounts@2021-09-01' = [for storageAccountName in storageAccountNames: { name: storageAccountName location: resourceGroup().location kind: 'StorageV2' sku: { name: 'Standard_LRS' } }] Notice that bicep requires ‚Äú[‚Äù before the for, and a closing bracket.\ncount loops resource storageAccountResources 'Microsoft.Storage/storageAccounts@2021-09-01' = [for i in range(1,4): { name: 'sa${i}' location: resourceGroup().location kind: 'StorageV2' sku: { name: 'Standard_LRS' } }] The range function takes two arguments. The first one specifies the starting value, and the second tells Bicep the number of values you want.\nIf you use range(3,4), you will get 3, 4, 5 and 6.\naccessing the index param locations array = [ 'westeurope' 'eastus2' 'eastasia' ] resource sqlServers 'Microsoft.Sql/servers@2021-11-01-preview' = [for (location, i) in locations: { name: 'sqlserver-${i+1}' location: location properties: { administratorLogin: administratorLogin administratorLoginPassword: administratorLoginPassword } }] The first value is zero, so you can add 1 to i if you want your names to be sqlserver-1, sqlserver-2 etc.\ni is used here, but you can use any value you want.\nFiltering with loops param sqlServerDetails array = [ { name: 'sqlserver-we' location: 'westeurope' environmentName: 'Production' } { name: 'sqlserver-eus2' location: 'eastus2' environmentName: 'Development' } { name: 'sqlserver-eas' location: 'eastasia' environmentName: 'Production' } ] resource sqlServers 'Microsoft.Sql/servers@2021-11-01-preview' = [for sqlServer in sqlServerDetails: if (sqlServer.environmentName == 'Production') { name: sqlServer.name location: sqlServer.location properties: { administratorLogin: administratorLogin administratorLoginPassword: administratorLoginPassword } tags: { environment: sqlServer.environmentName } }] This will deploy -we and -eas, but not -eus2, because the environmentName does not match Production.\nControlling loop execution By default all the iterations of a loop are executed simultaneously. However, you don‚Äôt always want this to be happening.\nTo control the amount you can use the @batchSize decorator.\n@batchSize(2) resource appServiceApp 'Microsoft.Web/sites@2021-03-01' = [for i in range(1,3): { name: 'app${i}' // ... }] Here bicep will wait for the first two to be fully completed before it moves to the next.\nTo loop sequentially, meaning one at a time in order, use @batchSize(1)\nVariable loops You can use loops to create arrays that you can use in the Bicep template.\nvar items = [for i in range(1, 5): 'item${i}'] This produces an array containing the values item1, item2 up to 5 stored in the items variable.\nReminds me of list comprehensions in python.\nHere is an example:\nparam addressPrefix string = '10.10.0.0/16' param subnets array = [ { name: 'frontend' ipAddressRange: '10.10.0.0/24' } { name: 'backend' ipAddressRange: '10.10.1.0/24' } ] var subnetsProperty = [for subnet in subnets: { name: subnet.name properties: { addressPrefix: subnet.ipAddressRange } }] resource virtualNetwork 'Microsoft.Network/virtualNetworks@2021-08-01' = { name: 'teddybear' location: resourceGroup().location properties:{ addressSpace:{ addressPrefixes:[ addressPrefix ] } subnets: subnetsProperty } } The content of the subnetsProperty array would look like this:\n[ { name: 'frontend', properties: { addressPrefix: '10.10.0.0/24' } }, { name: 'backend', properties: { addressPrefix: '10.10.1.0/24' } } ] Output loops To output the contents of the array:\nvar items = [ 'item1' 'item2' 'item3' 'item4' 'item5' ] output outputItems array = [for i in range(0, length(items)): items[i]] Modules You can create modules in Bicep so the code becomes reusable. You can share the modules with other teams and use them for different outcomes.\nGenerally, it‚Äôs not a good practice to create a module for every resource that you deploy. A good Bicep module typically defines multiple related resources. However, if you have a particularly complex resource with a lot of configuration, it might make sense to create a single module to encapsulate the complexity. This approach keeps your main templates simple and uncluttered.\nSo for example it would make sense to write a networking module and a database module that handles these resources.\nModules can be nested, but it can quickly become very complex.\nTo call a module in a template:\nmodule appModule 'modules/app.bicep' = { name: 'myApp' params: { location: location appServiceAppName: appServiceAppName environmentType: environmentType } } The modules are stored in the modules folder in your root directory.\nParameters Modules will take parameters, but it is good practice to leave out default values for parameters in modules. In templates it‚Äôs good practice to add defaults wherever you can. Therefore it is best to leave them out in modules because templates usually have their own default values. This can get confusing if you have similar default values in the templates and modules.\nModule dependency Bicep will figure out automatically if there is a dependency between modules. For example:\n@description('Username for the virtual machine.') param adminUsername string @description('Password for the virtual machine.') @minLength(12) @secure() param adminPassword string module virtualNetwork 'modules/vnet.bicep' = { name: 'virtual-network' } module virtualMachine 'modules/vm.bicep' = { name: 'virtual-machine' params: { adminUsername: adminUsername adminPassword: adminPassword subnetResourceId: virtualNetwork.outputs.subnetResourceId } } Here the virtualMachine module takes the subnetResourceId from the virtualNetwork module outputs.\nBecause it is defined like this, Bicep will wait with deploying the virtualMachine modul until the virtualNetwork module is finished, and pass in the required parameter.\nIt is important to note that this means that it will wait until the virtualNetwork module is completely finished. If it takes a long time to deploy the previous module, all the subsequent modules will have to wait until it‚Äôs finished.\n","wordCount":"1943","inLanguage":"en","image":"https://mischavandenburg.com/cloud-blue-logo.jpeg","datePublished":"2023-03-13T00:00:00Z","dateModified":"2023-03-13T00:00:00Z","author":{"@type":"Person","name":"Mischa van den Burg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/"},"publisher":{"@type":"Organization","name":"Mischa van den Burg","logo":{"@type":"ImageObject","url":"https://mischavandenburg.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mischavandenburg.com/ accesskey=h title="Mischa van den Burg (Alt + H)">Mischa van den Burg</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mischavandenburg.com/aboutme/ title=About><span>About</span></a></li><li><a href=https://mischavandenburg.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://mischavandenburg.com/archives/ title=Index><span>Index</span></a></li><li><a href=https://mischavandenburg.com/search/ title="üîç (Alt + /)" accesskey=/><span>üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Notes: Fundamentals of Bicep</h1><div class=post-meta><span title='2023-03-13 00:00:00 +0000 UTC'>March 13, 2023</span>&nbsp;¬∑&nbsp;Mischa van den Burg</div></header><div class=post-content><p>I&rsquo;ll be working with Bicep during my next contract, so I&rsquo;m working through the Bicep modules on Microsoft Learn to prepare. I must say¬†that these modules are particularly helpful. They are well structured and they provide you with free sandbox environments to practice deploying the templates you create.</p><h1 id=why-bicep>Why Bicep?<a hidden class=anchor aria-hidden=true href=#why-bicep>#</a></h1><p>Resources in Azure are deployed by the Azure Resource Manager (ARM). These resources are JSON objects under the covers, and ARM templates are a way to generate these JSON objects. However, JSON is not really meant to be edited by humans, and the ARM templates are not very suitable for editing either. Thus, Bicep was developed to allow for a better editing experience and better readability and reusability.</p><p>Bicep templates are transpiled into JSON objects, which are sent to the Azure API to create resources with the Azure Resource Manager.</p><h1 id=fundamentals-of-bicep-notes>Fundamentals of Bicep Notes<a hidden class=anchor aria-hidden=true href=#fundamentals-of-bicep-notes>#</a></h1><blockquote><p>A <em>parameter</em> lets you bring in values from outside the template file. For example, if someone is manually deploying the template by using the Azure CLI or Azure PowerShell, they&rsquo;ll be asked to provide values for each parameter. They can also create a <em>parameter file</em>, which lists all of the parameters and values they want to use for the deployment. If the template is deployed from an automated process like a deployment pipeline, the pipeline can provide the parameter values.</p></blockquote><blockquote><p>A <em>variable</em> is defined and set within the template. Variables let you store important information in one place and refer to it throughout the template without having to copy and paste it.</p></blockquote><h2 id=generating-unique-names>generating unique names<a hidden class=anchor aria-hidden=true href=#generating-unique-names>#</a></h2><blockquote><p>Bicep has another function called <code>uniqueString()</code> that comes in handy when you&rsquo;re creating resource names. When you use this function, you need to provide a <em>seed value</em>, which should be different across different deployments but consistent across all deployments of the same resources.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w> </span><span class=nv>string</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nf>uniqueString</span><span class=p>(</span><span class=nf>resourceGroup</span><span class=p>().</span><span class=nv>id</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><ul><li>Every time you deploy the same resources, they&rsquo;ll go into the same resource group. The <code>uniqueString()</code> function will return the same value every time.</li><li>If you deploy into two different resource groups in the Azure subscription, the <code>resourceGroup().id</code> value will be different, because the resource group names will be different. The <code>uniqueString()</code> function will give different values for each set of resources.</li><li>If you deploy into two different Azure subscriptions, <em>even if you use the same resource group name</em>, the <code>resourceGroup().id</code> value will be different because the Azure subscription ID will be different. The <code>uniqueString()</code> function will again give different values for each set of resources.</li></ul><h3 id=combining-strings>combining strings<a hidden class=anchor aria-hidden=true href=#combining-strings>#</a></h3><p>Can use string interpolation to generate a unique string with a recognizable hardcoded part:</p><p><code>param storageAccountName string = 'toylaunch${uniqueString(resourceGroup().id)}'</code></p><p>This can also be handy for generating correct names. For example, storage accounts may not begin with a number.</p><h2 id=parameter-decorators>parameter decorators<a hidden class=anchor aria-hidden=true href=#parameter-decorators>#</a></h2><h3 id=allowed-parameters>allowed parameters<a hidden class=anchor aria-hidden=true href=#allowed-parameters>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>allowed</span><span class=p>([</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;nonprod&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;prod&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>environmentType</span><span class=w> </span><span class=nv>string</span><span class=w>
</span></span></span></code></pre></div><p>The template cannot be deployed unless the nonprod or prod values are provided.</p><p>@allowed is a <em>parameter decorator</em>: it gives Bicep information on what the parameter&rsquo;s value needs to be.</p><p>You can also specify the allowed length of the parameter by using the following decorators:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>minLength</span><span class=p>(</span><span class=nv>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>@</span><span class=nf>maxLength</span><span class=p>(</span><span class=nv>24</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w> </span><span class=nv>string</span><span class=w>
</span></span></span></code></pre></div><p>You can apply multiple decorators to a parameter by putting each on a separate line.</p><p>These min and maxLength decorators can also be used to limit the length of an array.</p><p>To limit int values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>minValue</span><span class=p>(</span><span class=nv>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>@</span><span class=nf>maxValue</span><span class=p>(</span><span class=nv>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>appServicePlanInstanceCount</span><span class=w> </span><span class=nv>int</span><span class=w>
</span></span></span></code></pre></div><p>Finally, you can add descriptions to your parameters with the @description decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>description</span><span class=p>(</span><span class=s>&#39;The locations into which this Cosmos DB account should be configured. This parameter needs to be a list of objects, each of which has a locationName property.&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>cosmosDBAccountLocations</span><span class=w> </span><span class=nv>array</span><span class=w>
</span></span></span></code></pre></div><h2 id=if-statements>if statements<a hidden class=anchor aria-hidden=true href=#if-statements>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nv>storageAccountSkuName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>(</span><span class=nv>environmentType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#39;prod&#39;</span><span class=p>)</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=s>&#39;Standard_GRS&#39;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#39;Standard_LRS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nv>appServicePlanSkuName</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>(</span><span class=nv>environmentType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#39;prod&#39;</span><span class=p>)</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=s>&#39;P2V3&#39;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#39;F1&#39;</span><span class=w>
</span></span></span></code></pre></div><p>Let&rsquo;s unpack this:</p><p>? is a <em>ternary operator</em> and evaluates an if/then statement. The value after ? is used if the expression is true. If it&rsquo;s false, the value after : is used.</p><p>So here, if the environmentType is prod, the SKU is set to Standard_GRS</p><h2 id=objects-in-bicep>Objects in Bicep<a hidden class=anchor aria-hidden=true href=#objects-in-bicep>#</a></h2><p>You can use objects within resource definitions, within variables, or within expressions in your Bicep file.</p><p>Objects are the same as dictionaries in python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>appServicePlanSku</span><span class=w> </span><span class=nv>object</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;F1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>tier</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Free&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>capacity</span><span class=p>:</span><span class=w> </span><span class=nv>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>These are called &ldquo;properties&rdquo; of type string and int. Note that they are line separated, not comma separated like in python.</p><p>When referencing the parameter in the template, you can use dot notation to access the object properties:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>appServicePlan</span><span class=w> </span><span class=s>&#39;Microsoft.Web/serverfarms@2022-03-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanSku</span><span class=p>.</span><span class=nv>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>tier</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanSku</span><span class=p>.</span><span class=nv>tier</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>capacity</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanSku</span><span class=p>.</span><span class=nv>capacity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>[!important]
Keep in mind that you don&rsquo;t specify the type of each property within an object. However, when you use a property&rsquo;s value, its type must match what&rsquo;s expected. In the previous example, both the name and the tier of the App Service plan SKU must be strings.</p></blockquote><h3 id=example-tags>Example: tags<a hidden class=anchor aria-hidden=true href=#example-tags>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>resourceTags</span><span class=w> </span><span class=nv>object</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>EnvironmentName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Test&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>CostCenter</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1000100&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>Team</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Human Resources&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>appServicePlan</span><span class=w> </span><span class=s>&#39;Microsoft.Web/serverfarms@2022-03-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>tags</span><span class=p>:</span><span class=w> </span><span class=nv>resourceTags</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;S1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>appServiceApp</span><span class=w> </span><span class=s>&#39;Microsoft.Web/sites@&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>appServiceAppName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>tags</span><span class=p>:</span><span class=w> </span><span class=nv>resourceTags</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>kind</span><span class=p>:</span><span class=w> </span><span class=s>&#39;app&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>serverFarmId</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlan</span><span class=p>.</span><span class=nv>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Here we take the tags for all the resources of the template as parameters. But we easily reuse all the tags for each resource by referencing the entire object.</p><h2 id=arrays>Arrays<a hidden class=anchor aria-hidden=true href=#arrays>#</a></h2><p>Arrays are not typed in Bicep. You cannot specify that it must contain strings.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>cosmosDBAccountLocations</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>locationName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;australiaeast&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>locationName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;southcentralus&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>locationName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;westeurope&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>This is an array of objects, which have an locationName property each.</p><p>And you would access it by:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>account</span><span class=w> </span><span class=s>&#39;Microsoft.DocumentDB/databaseAccounts@2022-08-15&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>accountName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>locations</span><span class=p>:</span><span class=w> </span><span class=nv>cosmosDBAccountLocations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=specifying-parameter-values>Specifying parameter values<a hidden class=anchor aria-hidden=true href=#specifying-parameter-values>#</a></h2><p>When deploying a template file there are three options:</p><ol><li>default values</li><li>command line</li><li>parameter file</li></ol><h3 id=parameter-file>Parameter file<a hidden class=anchor aria-hidden=true href=#parameter-file>#</a></h3><p>This is a json file. To deploy a template with a paramter file, use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az deployment group create <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --template-file main.bicep <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --parameters main.parameters.json
</span></span></code></pre></div><h3 id=priority>priority<a hidden class=anchor aria-hidden=true href=#priority>#</a></h3><p>The order of priority is this, from high to low priority:</p><ol><li>Parameters specified on the command line</li><li>Parameter file</li><li>Default values in template</li></ol><h2 id=securing-parameters>Securing parameters<a hidden class=anchor aria-hidden=true href=#securing-parameters>#</a></h2><p>It is best to use Managed Identities for Azure, but if you need to supply secret values to a deployment, use the @secure() decorator. These values aren&rsquo;t available in the deployment logs, and they won&rsquo;t be displayed on the screen when entered in the terminal.</p><h2 id=loops>Loops<a hidden class=anchor aria-hidden=true href=#loops>#</a></h2><p>Defined with the for keyword. Usually you iterate over an array to create multiple instances of a resource.</p><h3 id=copy-loops>Copy loops<a hidden class=anchor aria-hidden=true href=#copy-loops>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>storageAccountNames</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;saauditus&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;saauditeurope&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;saauditapac&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccountResources</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2021-09-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nv>storageAccountNames</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nf>resourceGroup</span><span class=p>().</span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>kind</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageV2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Standard_LRS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></div><p>Notice that bicep requires &ldquo;[&rdquo; before the for, and a closing bracket.</p><h3 id=count-loops>count loops<a hidden class=anchor aria-hidden=true href=#count-loops>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccountResources</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2021-09-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>i</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nf>range</span><span class=p>(</span><span class=nv>1</span><span class=p>,</span><span class=nv>4</span><span class=p>):</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;sa</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s>&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nf>resourceGroup</span><span class=p>().</span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>kind</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageV2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Standard_LRS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></div><p>The range function takes two arguments. The first one specifies the starting value, and the second tells Bicep the number of values you want.</p><p>If you use range(3,4), you will get 3, 4, 5 and 6.</p><h4 id=accessing-the-index>accessing the index<a hidden class=anchor aria-hidden=true href=#accessing-the-index>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>locations</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;westeurope&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;eastus2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;eastasia&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>sqlServers</span><span class=w> </span><span class=s>&#39;Microsoft.Sql/servers@2021-11-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=p>(</span><span class=nv>location</span><span class=p>,</span><span class=w> </span><span class=nv>i</span><span class=p>)</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nv>locations</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;sqlserver-</span><span class=si>${</span><span class=nv>i</span><span class=o>+</span><span class=nv>1</span><span class=si>}</span><span class=s>&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>administratorLogin</span><span class=p>:</span><span class=w> </span><span class=nv>administratorLogin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>administratorLoginPassword</span><span class=p>:</span><span class=w> </span><span class=nv>administratorLoginPassword</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></div><p>The first value is zero, so you can add 1 to i if you want your names to be sqlserver-1, sqlserver-2 etc.</p><p>i is used here, but you can use any value you want.</p><h3 id=filtering-with-loops>Filtering with loops<a hidden class=anchor aria-hidden=true href=#filtering-with-loops>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>sqlServerDetails</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;sqlserver-we&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=s>&#39;westeurope&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>environmentName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Production&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;sqlserver-eus2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=s>&#39;eastus2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>environmentName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Development&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;sqlserver-eas&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=s>&#39;eastasia&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>environmentName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Production&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>sqlServers</span><span class=w> </span><span class=s>&#39;Microsoft.Sql/servers@2021-11-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>sqlServer</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nv>sqlServerDetails</span><span class=p>:</span><span class=w> </span><span class=kd>if</span><span class=w> </span><span class=p>(</span><span class=nv>sqlServer</span><span class=p>.</span><span class=nv>environmentName</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#39;Production&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>sqlServer</span><span class=p>.</span><span class=nv>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>sqlServer</span><span class=p>.</span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>administratorLogin</span><span class=p>:</span><span class=w> </span><span class=nv>administratorLogin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>administratorLoginPassword</span><span class=p>:</span><span class=w> </span><span class=nv>administratorLoginPassword</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>tags</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>environment</span><span class=p>:</span><span class=w> </span><span class=nv>sqlServer</span><span class=p>.</span><span class=nv>environmentName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></div><p>This will deploy -we and -eas, but not -eus2, because the environmentName does not match Production.</p><h3 id=controlling-loop-execution>Controlling loop execution<a hidden class=anchor aria-hidden=true href=#controlling-loop-execution>#</a></h3><p>By default all the iterations of a loop are executed simultaneously. However, you don&rsquo;t always want this to be happening.</p><p>To control the amount you can use the @batchSize decorator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>batchSize</span><span class=p>(</span><span class=nv>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>appServiceApp</span><span class=w> </span><span class=s>&#39;Microsoft.Web/sites@2021-03-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>i</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nf>range</span><span class=p>(</span><span class=nv>1</span><span class=p>,</span><span class=nv>3</span><span class=p>):</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;app</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s>&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></div><p>Here bicep will wait for the first two to be fully completed before it moves to the next.</p><p>To loop sequentially, meaning one at a time in order, use @batchSize(1)</p><h3 id=variable-loops>Variable loops<a hidden class=anchor aria-hidden=true href=#variable-loops>#</a></h3><p>You can use loops to create arrays that you can use in the Bicep template.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nv>items</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>i</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nf>range</span><span class=p>(</span><span class=nv>1</span><span class=p>,</span><span class=w> </span><span class=nv>5</span><span class=p>):</span><span class=w> </span><span class=s>&#39;item</span><span class=si>${</span><span class=nv>i</span><span class=si>}</span><span class=s>&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>This produces an array containing the values item1, item2 up to 5 stored in the items variable.</p><p>Reminds me of list comprehensions in python.</p><p>Here is an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>param</span><span class=w> </span><span class=nv>addressPrefix</span><span class=w> </span><span class=nv>string</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#39;10.10.0.0/16&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>subnets</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;frontend&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>ipAddressRange</span><span class=p>:</span><span class=w> </span><span class=s>&#39;10.10.0.0/24&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;backend&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>ipAddressRange</span><span class=p>:</span><span class=w> </span><span class=s>&#39;10.10.1.0/24&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nv>subnetsProperty</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>subnet</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nv>subnets</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>subnet</span><span class=p>.</span><span class=nv>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>addressPrefix</span><span class=p>:</span><span class=w> </span><span class=nv>subnet</span><span class=p>.</span><span class=nv>ipAddressRange</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>virtualNetwork</span><span class=w> </span><span class=s>&#39;Microsoft.Network/virtualNetworks@2021-08-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;teddybear&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nf>resourceGroup</span><span class=p>().</span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>addressSpace</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>addressPrefixes</span><span class=p>:[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>addressPrefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>subnets</span><span class=p>:</span><span class=w> </span><span class=nv>subnetsProperty</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The content of the subnetsProperty array would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;frontend&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>addressPrefix</span><span class=p>:</span><span class=w> </span><span class=s>&#39;10.10.0.0/24&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;backend&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>addressPrefix</span><span class=p>:</span><span class=w> </span><span class=s>&#39;10.10.1.0/24&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><h3 id=output-loops>Output loops<a hidden class=anchor aria-hidden=true href=#output-loops>#</a></h3><p>To output the contents of the array:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nv>items</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;item1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;item2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;item3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;item4&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;item5&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>output</span><span class=w> </span><span class=nv>outputItems</span><span class=w> </span><span class=nv>array</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[</span><span class=kd>for</span><span class=w> </span><span class=nv>i</span><span class=w> </span><span class=kd>in</span><span class=w> </span><span class=nf>range</span><span class=p>(</span><span class=nv>0</span><span class=p>,</span><span class=w> </span><span class=nf>length</span><span class=p>(</span><span class=nv>items</span><span class=p>)):</span><span class=w> </span><span class=nv>items</span><span class=p>[</span><span class=nv>i</span><span class=p>]]</span><span class=w>
</span></span></span></code></pre></div><h2 id=modules>Modules<a hidden class=anchor aria-hidden=true href=#modules>#</a></h2><p>You can create modules in Bicep so the code becomes reusable. You can share the modules with other teams and use them for different outcomes.</p><blockquote><p>Generally, it&rsquo;s not a good practice to create a module for every resource that you deploy. A good Bicep module typically defines multiple related resources. However, if you have a particularly complex resource with a lot of configuration, it might make sense to create a single module to encapsulate the complexity. This approach keeps your main templates simple and uncluttered.</p></blockquote><p>So for example it would make sense to write a networking module and a database module that handles these resources.</p><p>Modules can be nested, but it can quickly become very complex.</p><p>To call a module in a template:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>module</span><span class=w> </span><span class=nv>appModule</span><span class=w> </span><span class=s>&#39;modules/app.bicep&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;myApp&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>params</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>appServiceAppName</span><span class=p>:</span><span class=w> </span><span class=nv>appServiceAppName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>environmentType</span><span class=p>:</span><span class=w> </span><span class=nv>environmentType</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The modules are stored in the modules folder in your root directory.</p><h3 id=parameters>Parameters<a hidden class=anchor aria-hidden=true href=#parameters>#</a></h3><p>Modules will take parameters, but it is good practice to leave out default values for parameters in modules. In templates it&rsquo;s good practice to add defaults wherever you can. Therefore it is best to leave them out in modules because templates usually have their own default values. This can get confusing if you have similar default values in the templates and modules.</p><h3 id=module-dependency>Module dependency<a hidden class=anchor aria-hidden=true href=#module-dependency>#</a></h3><p>Bicep will figure out automatically if there is a dependency between modules. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>description</span><span class=p>(</span><span class=s>&#39;Username for the virtual machine.&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>adminUsername</span><span class=w> </span><span class=nv>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>@</span><span class=nf>description</span><span class=p>(</span><span class=s>&#39;Password for the virtual machine.&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>@</span><span class=nf>minLength</span><span class=p>(</span><span class=nv>12</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>@</span><span class=nf>secure</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>adminPassword</span><span class=w> </span><span class=nv>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>module</span><span class=w> </span><span class=nv>virtualNetwork</span><span class=w> </span><span class=s>&#39;modules/vnet.bicep&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;virtual-network&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>module</span><span class=w> </span><span class=nv>virtualMachine</span><span class=w> </span><span class=s>&#39;modules/vm.bicep&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;virtual-machine&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>params</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>adminUsername</span><span class=p>:</span><span class=w> </span><span class=nv>adminUsername</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>adminPassword</span><span class=p>:</span><span class=w> </span><span class=nv>adminPassword</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>subnetResourceId</span><span class=p>:</span><span class=w> </span><span class=nv>virtualNetwork</span><span class=p>.</span><span class=nv>outputs</span><span class=p>.</span><span class=nv>subnetResourceId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Here the virtualMachine module takes the subnetResourceId from the virtualNetwork module outputs.</p><p>Because it is defined like this, Bicep will wait with deploying the virtualMachine modul until the virtualNetwork module is finished, and pass in the required parameter.</p><p>It is important to note that this means that it will wait until the virtualNetwork module is completely finished. If it takes a long time to deploy the previous module, all the subsequent modules will have to wait until it&rsquo;s finished.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://mischavandenburg.com/tags/article/>Article</a></li><li><a href=https://mischavandenburg.com/tags/study/>Study</a></li><li><a href=https://mischavandenburg.com/tags/azure/>Azure</a></li><li><a href=https://mischavandenburg.com/tags/coding/>Coding</a></li><li><a href=https://mischavandenburg.com/tags/bicep/>Bicep</a></li></ul><nav class=paginav><a class=prev href=https://mischavandenburg.com/zet/intermediate-bicep/><span class=title>¬´ Prev</span><br><span>Notes: Intermediate Bicep</span>
</a><a class=next href=https://mischavandenburg.com/zet/go-day-1/><span class=title>Next ¬ª</span><br><span>Learning Go Day 1: Notes</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on x" href="https://x.com/intent/tweet/?text=Notes%3a%20Fundamentals%20of%20Bicep&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f&amp;hashtags=Article%2cStudy%2cAzure%2cCoding%2cBicep"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f&amp;title=Notes%3a%20Fundamentals%20of%20Bicep&amp;summary=Notes%3a%20Fundamentals%20of%20Bicep&amp;source=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f&title=Notes%3a%20Fundamentals%20of%20Bicep"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on whatsapp" href="https://api.whatsapp.com/send?text=Notes%3a%20Fundamentals%20of%20Bicep%20-%20https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on telegram" href="https://telegram.me/share/url?text=Notes%3a%20Fundamentals%20of%20Bicep&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Fundamentals of Bicep on ycombinator" href="https://news.ycombinator.com/submitlink?t=Notes%3a%20Fundamentals%20of%20Bicep&u=https%3a%2f%2fmischavandenburg.com%2fzet%2farticles%2ffundamentals-of-bicep%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://mischavandenburg.com/>Mischa van den Burg</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>