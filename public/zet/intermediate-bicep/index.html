<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Notes: Intermediate Bicep | Mischa van den Burg</title>
<meta name=keywords content="Bicep,Azure,Coding,Study"><meta name=description content="Today I finished the Intermediate Bicep module. Here are my notes.
Child and Extension

You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they&rsquo;re in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure."><meta name=author content="Mischa van den Burg"><link rel=canonical href=https://mischavandenburg.com/zet/intermediate-bicep/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://mischavandenburg.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mischavandenburg.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mischavandenburg.com/favicon-32x32.png><link rel=apple-touch-icon href=https://mischavandenburg.com/apple-touch-icon.png><link rel=mask-icon href=https://mischavandenburg.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mischavandenburg.com/zet/intermediate-bicep/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLS3GJYW82"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLS3GJYW82")}</script><meta property="og:url" content="https://mischavandenburg.com/zet/intermediate-bicep/"><meta property="og:site_name" content="Mischa van den Burg"><meta property="og:title" content="Notes: Intermediate Bicep"><meta property="og:description" content="Today I finished the Intermediate Bicep module. Here are my notes.
Child and Extension You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they‚Äôre in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="zet"><meta property="article:published_time" content="2023-03-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-14T00:00:00+00:00"><meta property="article:tag" content="Bicep"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Coding"><meta property="article:tag" content="Study"><meta property="og:image" content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mischavandenburg.com/cloud-blue-logo.jpeg"><meta name=twitter:title content="Notes: Intermediate Bicep"><meta name=twitter:description content="Today I finished the Intermediate Bicep module. Here are my notes.
Child and Extension

You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they&rsquo;re in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Zettelkasten","item":"https://mischavandenburg.com/zet/"},{"@type":"ListItem","position":2,"name":"Notes: Intermediate Bicep","item":"https://mischavandenburg.com/zet/intermediate-bicep/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Notes: Intermediate Bicep","name":"Notes: Intermediate Bicep","description":"Today I finished the Intermediate Bicep module. Here are my notes.\nChild and Extension You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they\u0026rsquo;re in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure.\n","keywords":["Bicep","Azure","Coding","Study"],"articleBody":"Today I finished the Intermediate Bicep module. Here are my notes.\nChild and Extension You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they‚Äôre in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure.\nSome resources are only deployed in context of their parent. For example:\nVirtual network subnets Microsoft.Network/virtualNetworks/subnets App Service configuration Microsoft.Web/sites/config SQL databases Microsoft.Sql/servers/databases Virtual machine extensions Microsoft.Compute/virtualMachines/extensions Storage blob containers Microsoft.Storage/storageAccounts/blobServices/containers Azure Cosmos DB containers\nIt does not make sense for a container to exist without a storage account.\nDifference between child and extension In summary, you define extensions with the scope keyword, and child resources are defined by nesting them or by using the parent keyword.\nAn extension resource is a resource that modifies another resource. For example, assigning a role to a resource.\nA child resource is a resource that exists only within the context of another resource, such as a subnet existing only within a vnet.\nNested resource resource vm 'Microsoft.Compute/virtualMachines@2020-06-01' = { name: vmName location: location properties: { // ... } resource installCustomScriptExtension 'extensions' = { name: 'InstallCustomScript' location: location properties: { // ... } } } Here the extension resource is within the vm resource. The fully qualified domain name is Microsoft.Compute/virtualMachines/extensions, but it is not necessary because it inherits it from the parent. Therefore we only need to specify ‚Äôextensions‚Äô here.\nNo API version is specified either, this is also inherited.\nYou can refer to a nested resource by using the :: operator. For example, you could create an output that will return the full resource ID of the extension:\noutput childResourceId string = vm::installCustomScriptExtension.id Parent property This is the second way to declare a child resource.\nresource vm 'Microsoft.Compute/virtualMachines@2020-06-01' = { name: vmName location: location properties: { // ... } } resource installCustomScriptExtension 'Microsoft.Compute/virtualMachines/extensions@2020-06-01' = { parent: vm name: 'InstallCustomScript' location: location properties: { // ... } } dependsOn use dependsOn to indicate a dependency.\ndependsOn: [ vm ] Extension resources Extension resources are always attached to other Azure resources. They extend them with extra functionality. Some examples are role assignments, locks, and policy assignments.\nIt doesn‚Äôt make sense to deploy a lock by itself. It always has to be deployed to another resource, because it prevents deletion or modification of a resource.\nResources are defined almost the same way as normal resources, but you add the scope property to tell Bicep that it is attached to another resource in the template.\nresource cosmosDBAccount 'Microsoft.DocumentDB/databaseAccounts@2020-04-01' = { name: cosmosDBAccountName location: location properties: { // ... } } resource lockResource 'Microsoft.Authorization/locks@2016-09-01' = { scope: cosmosDBAccount name: 'DontDelete' properties: { level: 'CanNotDelete' notes: 'Prevents deletion of the toy data Cosmos DB account.' } } Extensions have slightly different resource ID‚Äôs. They consist of the parent resource ID, the separator /providers/, and the extension resource ID.\nIf you see a resource ID that starts with a normal resource ID and then adds /providers/ and another resource type and name, it means that you‚Äôre looking at an extension resource ID.\nExisting resources Bicep files often need to refer to resources that have been already created elswewhere. They might have been created in the portal or by another Bicep file.\nHere you use the existing keyword in Bicep. You are defining a resource that already exists, and therefore you are telling Bicep that it shouldn‚Äôt try to deploy it. Think of it as a placeholder resource.\nYou can do the same for nested or child resources.\nresource storageAccount 'Microsoft.Storage/storageAccounts@2019-06-01' existing = { name: 'toydesigndocs' } Existing resources outside of the resource group and subscription resource vnet 'Microsoft.Network/virtualNetworks@2020-11-01' existing = { scope: resourceGroup('f0750bbe-ea75-4ae5-b24d-a92ca601da2c', 'networking-rg') name: 'toy-design-vnet' } You can refer to these as long as they are within your Azure AD tenant.\nAdd child and extension resources to an existing resource resource server 'Microsoft.Sql/servers@2020-11-01-preview' existing = { name: serverName } resource database 'Microsoft.Sql/servers/databases@2020-11-01-preview' = { parent: server name: databaseName location: location sku: { name: 'Standard' tier: 'Standard' } } Use the existing keyword to refer to the resource, and then you add the child by specifying the parent property.\nFinally, to deploy an extension resource to an existing resource, use the scope keyword:\nresource storageAccount 'Microsoft.Storage/storageAccounts@2019-06-01' existing = { name: 'toydesigndocs' } resource lockResource 'Microsoft.Authorization/locks@2016-09-01' = { scope: storageAccount name: 'DontDelete' properties: { level: 'CanNotDelete' notes: 'Prevents deletion of the toy design documents storage account.' } } Referring to an existing resource‚Äôs properties Define the resource and you can refer to its properties if the prperty isn‚Äôt secure.\nresource applicationInsights 'Microsoft.Insights/components@2018-05-01-preview' existing = { name: applicationInsightsName } resource functionApp 'Microsoft.Web/sites@2020-06-01' = { name: functionAppName location: location kind: 'functionapp' properties: { siteConfig: { appSettings: [ // ... { name: 'APPINSIGHTS_INSTRUMENTATIONKEY' value: applicationInsights.properties.InstrumentationKey } ] } } } When you need to access secure data, use the listKeys() function.\nresource storageAccount 'Microsoft.Storage/storageAccounts@2019-06-01' existing = { name: storageAccountName } resource functionApp 'Microsoft.Web/sites@2020-06-01' = { name: functionAppName location: location kind: 'functionapp' properties: { siteConfig: { appSettings: [ // ... { name: 'StorageAccountKey' value: storageAccount.listKeys().keys[0].value } ] } } } The VScode extension will show hints to help you understand the data this function returns.\nYou need to have sufficient permissions to use the listKeys function.\nChild and extension In this example we are attaching an extension to a child resource.\nresource storageAccount 'Microsoft.Storage/storageAccounts@2019-06-01' existing = { name: storageAccountName resource blobService 'blobServices' existing = { name: 'default' } } /* Note: Here we are attaching to blobServices which itself is a child resource. So we are attaching an extension to a child resource. */ resource storageAccountBlobDiagnostics 'Microsoft.Insights/diagnosticSettings@2017-05-01-preview' = { scope: storageAccount::blobService name: storageAccountBlobDiagnosticSettingsName properties: { workspaceId: logAnalyticsWorkspace.id logs: [ { category: 'StorageRead' enabled: true } { category: 'StorageWrite' enabled: true } { category: 'StorageDelete' enabled: true } ] } } Structuring Bicep for Collaboration configuration maps Using many different parameters can be confusing to the user of the template you‚Äôre writing. One way of solving this is by creating a config map:\n@allowed([ 'Production' 'Test' ]) param environmentType string = 'Test' var environmentConfigurationMap = { Production: { appServicePlan: { sku: { name: 'P2V3' capacity: 3 } } storageAccount: { sku: { name: 'ZRS' } } } Test: { appServicePlan: { sku: { name: 'S2' capacity: 1 } } storageAccount: { sku: { name: 'LRS' } } } } resource appServicePlan 'Microsoft.Web/serverfarms@2020-06-01' = { name: appServicePlanName location: location sku: environmentConfigurationMap[environmentType].appServicePlan.sku } Here we are taking a parameter for the environment, but create an object that contains the settings for that particular environment. Note that we are accessing it like we‚Äôd access a dictionary in python: sku: environmentConfigurationMap[environmentType].appServicePlan.sku\nNaming In Bicep, you ordinarily use camelCase capitalization style for the names of parameters, variables, and resource symbolic names.\nResource names cannot be renamed after they‚Äôre deployed in Azure.\nComments use // for single line comments, and /* */ for multi-line comments.\nWhen adding comments to JSON files, you might have to save the file as jsonc to let the code editor know that comments are allowed.\n","wordCount":"1209","inLanguage":"en","image":"https://mischavandenburg.com/cloud-blue-logo.jpeg","datePublished":"2023-03-14T00:00:00Z","dateModified":"2023-03-14T00:00:00Z","author":{"@type":"Person","name":"Mischa van den Burg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mischavandenburg.com/zet/intermediate-bicep/"},"publisher":{"@type":"Organization","name":"Mischa van den Burg","logo":{"@type":"ImageObject","url":"https://mischavandenburg.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mischavandenburg.com/ accesskey=h title="Mischa van den Burg (Alt + H)">Mischa van den Burg</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mischavandenburg.com/aboutme/ title=About><span>About</span></a></li><li><a href=https://mischavandenburg.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://mischavandenburg.com/archives/ title=Index><span>Index</span></a></li><li><a href=https://mischavandenburg.com/search/ title="üîç (Alt + /)" accesskey=/><span>üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Notes: Intermediate Bicep</h1><div class=post-meta><span title='2023-03-14 00:00:00 +0000 UTC'>March 14, 2023</span>&nbsp;¬∑&nbsp;Mischa van den Burg</div></header><div class=post-content><p>Today I finished the Intermediate Bicep module. Here are my notes.</p><h1 id=child-and-extension>Child and Extension<a hidden class=anchor aria-hidden=true href=#child-and-extension>#</a></h1><blockquote><p>You can also use Bicep to refer to resources that were created outside the Bicep file itself. For example, you can refer to resources that your colleagues have created manually by using the Azure portal, or from within another Bicep template or module, even if they&rsquo;re in a different resource group or subscription. By using these features of Bicep, you can unlock the ability to create powerful templates that deploy all aspects of your Azure infrastructure.</p></blockquote><p>Some resources are only deployed in context of their parent. For example:</p><p>Virtual network subnets Microsoft.Network/virtualNetworks/subnets
App Service configuration Microsoft.Web/sites/config
SQL databases Microsoft.Sql/servers/databases
Virtual machine extensions Microsoft.Compute/virtualMachines/extensions
Storage blob containers Microsoft.Storage/storageAccounts/blobServices/containers
Azure Cosmos DB containers</p><p>It does not make sense for a container to exist without a storage account.</p><h2 id=difference-between-child-and-extension>Difference between child and extension<a hidden class=anchor aria-hidden=true href=#difference-between-child-and-extension>#</a></h2><p>In summary, you define extensions with the <code>scope</code> keyword, and child resources are defined by nesting them or by using the <code>parent</code> keyword.</p><p>An extension resource is a resource that modifies another resource. For example, assigning a role to a resource.</p><p>A child resource is a resource that exists only within the context of another resource, such as a subnet existing only within a vnet.</p><h2 id=nested-resource>Nested resource<a hidden class=anchor aria-hidden=true href=#nested-resource>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>vm</span><span class=w> </span><span class=s>&#39;Microsoft.Compute/virtualMachines@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>vmName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>resource</span><span class=w> </span><span class=nv>installCustomScriptExtension</span><span class=w> </span><span class=s>&#39;extensions&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;InstallCustomScript&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Here the extension resource is within the vm resource. The fully qualified domain name is <code>Microsoft.Compute/virtualMachines/extensions</code>, but it is not necessary because it inherits it from the parent. Therefore we only need to specify &rsquo;extensions&rsquo; here.</p><p>No API version is specified either, this is also inherited.</p><blockquote><p>You can refer to a nested resource by using the :: operator. For example, you could create an output that will return the full resource ID of the extension:</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>output</span><span class=w> </span><span class=nv>childResourceId</span><span class=w> </span><span class=nv>string</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nv>vm</span><span class=o>::</span><span class=nv>installCustomScriptExtension</span><span class=p>.</span><span class=nv>id</span><span class=w>
</span></span></span></code></pre></div><h2 id=parent-property>Parent property<a hidden class=anchor aria-hidden=true href=#parent-property>#</a></h2><p>This is the second way to declare a child resource.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>vm</span><span class=w> </span><span class=s>&#39;Microsoft.Compute/virtualMachines@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>vmName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>installCustomScriptExtension</span><span class=w> </span><span class=s>&#39;Microsoft.Compute/virtualMachines/extensions@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>vm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;InstallCustomScript&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=dependson>dependsOn<a hidden class=anchor aria-hidden=true href=#dependson>#</a></h2><p>use dependsOn to indicate a dependency.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=nv>dependsOn</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>vm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><h2 id=extension-resources>Extension resources<a hidden class=anchor aria-hidden=true href=#extension-resources>#</a></h2><p>Extension resources are always attached to other Azure resources. They extend them with extra functionality. Some examples are role assignments, locks, and policy assignments.</p><p>It doesn&rsquo;t make sense to deploy a lock by itself. It always has to be deployed to another resource, because it prevents deletion or modification of a resource.</p><p>Resources are defined almost the same way as normal resources, but you add the <code>scope</code> property to tell Bicep that it is attached to another resource in the template.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>cosmosDBAccount</span><span class=w> </span><span class=s>&#39;Microsoft.DocumentDB/databaseAccounts@2020-04-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>cosmosDBAccountName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>lockResource</span><span class=w> </span><span class=s>&#39;Microsoft.Authorization/locks@2016-09-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>scope</span><span class=p>:</span><span class=w> </span><span class=nv>cosmosDBAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;DontDelete&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>level</span><span class=p>:</span><span class=w> </span><span class=s>&#39;CanNotDelete&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>notes</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Prevents deletion of the toy data Cosmos DB account.&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Extensions have slightly different resource ID&rsquo;s. They consist of the parent resource ID, the separator <code>/providers/</code>, and the extension resource ID.</p><blockquote><p>If you see a resource ID that starts with a normal resource ID and then adds /providers/ and another resource type and name, it means that you&rsquo;re looking at an extension resource ID.</p></blockquote><h3 id=existing-resources>Existing resources<a hidden class=anchor aria-hidden=true href=#existing-resources>#</a></h3><p>Bicep files often need to refer to resources that have been already created elswewhere. They might have been created in the portal or by another Bicep file.</p><p>Here you use the <code>existing</code> keyword in Bicep. You are defining a resource that already exists, and therefore you are telling Bicep that it shouldn&rsquo;t try to deploy it. Think of it as a placeholder resource.</p><p>You can do the same for nested or child resources.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccount</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2019-06-01&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;toydesigndocs&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=existing-resources-outside-of-the-resource-group-and-subscription>Existing resources outside of the resource group and subscription<a hidden class=anchor aria-hidden=true href=#existing-resources-outside-of-the-resource-group-and-subscription>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>vnet</span><span class=w> </span><span class=s>&#39;Microsoft.Network/virtualNetworks@2020-11-01&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>scope</span><span class=p>:</span><span class=w> </span><span class=nf>resourceGroup</span><span class=p>(</span><span class=s>&#39;f0750bbe-ea75-4ae5-b24d-a92ca601da2c&#39;</span><span class=p>,</span><span class=w> </span><span class=s>&#39;networking-rg&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;toy-design-vnet&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>You can refer to these as long as they are within your Azure AD tenant.</p><h2 id=add-child-and-extension-resources-to-an-existing-resource>Add child and extension resources to an existing resource<a hidden class=anchor aria-hidden=true href=#add-child-and-extension-resources-to-an-existing-resource>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>server</span><span class=w> </span><span class=s>&#39;Microsoft.Sql/servers@2020-11-01-preview&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>serverName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>database</span><span class=w> </span><span class=s>&#39;Microsoft.Sql/servers/databases@2020-11-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>parent</span><span class=p>:</span><span class=w> </span><span class=nv>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>databaseName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Standard&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>tier</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Standard&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Use the <code>existing</code> keyword to refer to the resource, and then you add the child by specifying the <code>parent</code> property.</p><p>Finally, to deploy an extension resource to an existing resource, use the <code>scope</code> keyword:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccount</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2019-06-01&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;toydesigndocs&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>lockResource</span><span class=w> </span><span class=s>&#39;Microsoft.Authorization/locks@2016-09-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>scope</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;DontDelete&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>level</span><span class=p>:</span><span class=w> </span><span class=s>&#39;CanNotDelete&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>notes</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Prevents deletion of the toy design documents storage account.&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=referring-to-an-existing-resources-properties>Referring to an existing resource&rsquo;s properties<a hidden class=anchor aria-hidden=true href=#referring-to-an-existing-resources-properties>#</a></h2><p>Define the resource and you can refer to its properties if the prperty isn&rsquo;t secure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>applicationInsights</span><span class=w> </span><span class=s>&#39;Microsoft.Insights/components@2018-05-01-preview&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>applicationInsightsName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>functionApp</span><span class=w> </span><span class=s>&#39;Microsoft.Web/sites@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>functionAppName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>kind</span><span class=p>:</span><span class=w> </span><span class=s>&#39;functionapp&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>siteConfig</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>appSettings</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;APPINSIGHTS_INSTRUMENTATIONKEY&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nv>value</span><span class=p>:</span><span class=w> </span><span class=nv>applicationInsights</span><span class=p>.</span><span class=nv>properties</span><span class=p>.</span><span class=nv>InstrumentationKey</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>When you need to access secure data, use the listKeys() function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccount</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2019-06-01&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>functionApp</span><span class=w> </span><span class=s>&#39;Microsoft.Web/sites@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>functionAppName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>kind</span><span class=p>:</span><span class=w> </span><span class=s>&#39;functionapp&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>siteConfig</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>appSettings</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageAccountKey&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nv>value</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccount</span><span class=p>.</span><span class=nf>listKeys</span><span class=p>().</span><span class=nv>keys</span><span class=p>[</span><span class=nv>0</span><span class=p>].</span><span class=nv>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The VScode extension will show hints to help you understand the data this function returns.</p><p>You need to have sufficient permissions to use the listKeys function.</p><h2 id=child-and-extension-1>Child and extension<a hidden class=anchor aria-hidden=true href=#child-and-extension-1>#</a></h2><p>In this example we are attaching an extension to a child resource.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccount</span><span class=w> </span><span class=s>&#39;Microsoft.Storage/storageAccounts@2019-06-01&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccountName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>resource</span><span class=w> </span><span class=nv>blobService</span><span class=w> </span><span class=s>&#39;blobServices&#39;</span><span class=w> </span><span class=kd>existing</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;default&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* Note: Here we are attaching to blobServices which itself is a child resource. So we are attaching an extension to a child resource. */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>storageAccountBlobDiagnostics</span><span class=w> </span><span class=s>&#39;Microsoft.Insights/diagnosticSettings@2017-05-01-preview&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>scope</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccount</span><span class=o>::</span><span class=nv>blobService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>storageAccountBlobDiagnosticSettingsName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>properties</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>workspaceId</span><span class=p>:</span><span class=w> </span><span class=nv>logAnalyticsWorkspace</span><span class=p>.</span><span class=nv>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>logs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>category</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageRead&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>category</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageWrite&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>category</span><span class=p>:</span><span class=w> </span><span class=s>&#39;StorageDelete&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h1 id=structuring-bicep-for-collaboration>Structuring Bicep for Collaboration<a hidden class=anchor aria-hidden=true href=#structuring-bicep-for-collaboration>#</a></h1><h2 id=configuration-maps>configuration maps<a hidden class=anchor aria-hidden=true href=#configuration-maps>#</a></h2><p>Using many different parameters can be confusing to the user of the template you&rsquo;re writing. One way of solving this is by creating a config map:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bicep data-lang=bicep><span class=line><span class=cl><span class=p>@</span><span class=nf>allowed</span><span class=p>([</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;Production&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#39;Test&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>param</span><span class=w> </span><span class=nv>environmentType</span><span class=w> </span><span class=nv>string</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#39;Test&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nv>environmentConfigurationMap</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>Production</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>appServicePlan</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;P2V3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>capacity</span><span class=p>:</span><span class=w> </span><span class=nv>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>storageAccount</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ZRS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>Test</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>appServicePlan</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;S2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>capacity</span><span class=p>:</span><span class=w> </span><span class=nv>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nv>storageAccount</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;LRS&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>resource</span><span class=w> </span><span class=nv>appServicePlan</span><span class=w> </span><span class=s>&#39;Microsoft.Web/serverfarms@2020-06-01&#39;</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=nv>appServicePlanName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>location</span><span class=p>:</span><span class=w> </span><span class=nv>location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nv>sku</span><span class=p>:</span><span class=w> </span><span class=nv>environmentConfigurationMap</span><span class=p>[</span><span class=nv>environmentType</span><span class=p>].</span><span class=nv>appServicePlan</span><span class=p>.</span><span class=nv>sku</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Here we are taking a parameter for the environment, but create an object that contains the settings for that particular environment. Note that we are accessing it like we&rsquo;d access a dictionary in python: <code>sku: environmentConfigurationMap[environmentType].appServicePlan.sku</code></p><h2 id=naming>Naming<a hidden class=anchor aria-hidden=true href=#naming>#</a></h2><blockquote><p>In Bicep, you ordinarily use camelCase capitalization style for the names of parameters, variables, and resource symbolic names.</p></blockquote><p>Resource names cannot be renamed after they&rsquo;re deployed in Azure.</p><h2 id=comments>Comments<a hidden class=anchor aria-hidden=true href=#comments>#</a></h2><p>use // for single line comments, and /* */ for multi-line comments.</p><p>When adding comments to JSON files, you might have to save the file as jsonc to let the code editor know that comments are allowed.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://mischavandenburg.com/tags/bicep/>Bicep</a></li><li><a href=https://mischavandenburg.com/tags/azure/>Azure</a></li><li><a href=https://mischavandenburg.com/tags/coding/>Coding</a></li><li><a href=https://mischavandenburg.com/tags/study/>Study</a></li></ul><nav class=paginav><a class=prev href=https://mischavandenburg.com/zet/docker-kubernetes-on-mac-m2/><span class=title>¬´ Prev</span><br><span>Running Docker and Kubernetes on Mac M2</span>
</a><a class=next href=https://mischavandenburg.com/zet/articles/fundamentals-of-bicep/><span class=title>Next ¬ª</span><br><span>Notes: Fundamentals of Bicep</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on x" href="https://x.com/intent/tweet/?text=Notes%3a%20Intermediate%20Bicep&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f&amp;hashtags=Bicep%2cAzure%2cCoding%2cStudy"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f&amp;title=Notes%3a%20Intermediate%20Bicep&amp;summary=Notes%3a%20Intermediate%20Bicep&amp;source=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f&title=Notes%3a%20Intermediate%20Bicep"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on whatsapp" href="https://api.whatsapp.com/send?text=Notes%3a%20Intermediate%20Bicep%20-%20https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on telegram" href="https://telegram.me/share/url?text=Notes%3a%20Intermediate%20Bicep&amp;url=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Notes: Intermediate Bicep on ycombinator" href="https://news.ycombinator.com/submitlink?t=Notes%3a%20Intermediate%20Bicep&u=https%3a%2f%2fmischavandenburg.com%2fzet%2fintermediate-bicep%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://mischavandenburg.com/>Mischa van den Burg</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>